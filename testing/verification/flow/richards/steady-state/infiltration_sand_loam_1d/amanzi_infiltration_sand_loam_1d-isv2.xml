<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<amanzi_input type="unstructured" version="2.0.0">
    <model_description name="Richards-1D-infiltration_sand_loam"/>

    <definitions>
        <macros>
            <cycle_macro name="Every_100">
                <start>0</start>
                <timestep_interval>100</timestep_interval>
                <stop>-1</stop>
            </cycle_macro>
            <cycle_macro name="Every_1000">
                <start>0</start>
                <timestep_interval>1000</timestep_interval>
                <stop>-1</stop>
            </cycle_macro>
        </macros>
    </definitions>
 
    <process_kernels>
        <flow model="richards" state="on"/>
        <transport algorithm="explicit first-order" state="off"/>
        <chemistry process_model="none" state="off"/>
    </process_kernels>

    <execution_controls>
        <verbosity level="medium"/>
        <execution_control_defaults increase_factor="1.2" reduction_factor="0.8"/>
        <execution_control end="10000 y" increase_factor="1.25" init_dt="2 s" max_dt="1000 y" method="bdf1" mode="steady" reduction_factor="0.8" start="0 y"/>
    </execution_controls>

    <numerical_controls>
        <steady-state_controls>
            <min_iterations>10</min_iterations>
            <max_iterations>15</max_iterations>
            <limit_iterations>20</limit_iterations>
            <max_preconditioner_lag_iterations>1</max_preconditioner_lag_iterations>
            <nonlinear_tolerance>1.0e-6</nonlinear_tolerance>
            <nonlinear_iteration_damping_factor>1</nonlinear_iteration_damping_factor>
            <nonlinear_iteration_divergence_factor>1000</nonlinear_iteration_divergence_factor>
            <max_divergent_iterations>3</max_divergent_iterations>
        </steady-state_controls>
        <linear_solver>
            <method>gmres</method>
            <max_iterations>100</max_iterations>
            <tolerance>1.0e-16</tolerance>
            <clf>1.0e-16</clf>
            <preconditioner name="hypre_amg">
                <hypre_cycle_applications>5</hypre_cycle_applications>
                <hypre_smoother_sweeps>3</hypre_smoother_sweeps>
                <hypre_tolerance>0.0</hypre_tolerance>
                <hypre_strong_threshold>0.5</hypre_strong_threshold>
            </preconditioner>
        </linear_solver>
        <nonlinear_solver name="nka"/>
    </numerical_controls>

    <mesh framework="mstk">
        <dimension>3</dimension>
        <generate>
            <number_of_cells nx="1" ny="1" nz="200"/>
            <box high_coordinates="(1.0, 1.0, 2.0)" low_coordinates="(0.0, 0.0, 0.0)"/>
        </generate>
    </mesh>

    <regions>
        <box high_coordinates="(1.0, 1.0, 2.0)" low_coordinates="(0.0, 0.0, 2.0)" name="Top Surface"/>
        <box high_coordinates="(1.0, 1.0, 0.0)" low_coordinates="(0.0, 0.0, 0.0)" name="Bottom Surface"/>
        <box high_coordinates="(1.0, 1.0, 2.0)" low_coordinates="(0.0, 0.0, 1.5)" name="Top Region"/>
        <box high_coordinates="(1.0, 1.0, 1.5)" low_coordinates="(0.0, 0.0, 0.0)" name="Bottom Region"/>
    </regions>

    <materials>
        <material name="loam">
            <mechanical_properties>
                <porosity value="0.43"/>
                <particle_density value="2720.0"/>
            </mechanical_properties>
            <permeability x="5.92360e-13" y="5.92360e-13" z="5.92360e-13"/>
            <cap_pressure model="van_genuchten">
                <parameters alpha="4.08622e-4" m="0.375" sr="0.186047"/>
            </cap_pressure>
            <rel_perm model="mualem"/>
            <assigned_regions>Bottom Region</assigned_regions>
        </material>
        <material name="sand">
            <mechanical_properties>
                <porosity value="0.43"/>
                <particle_density value="2720.0"/>
            </mechanical_properties>
            <permeability x="1.18472E-11" y="1.18472E-11" z="1.18472E-11"/>
            <cap_pressure model="van_genuchten">
                <parameters alpha="1.532333E-03" m="0.6666667" sr="0.104651"/>
            </cap_pressure>
            <rel_perm model="mualem"/>
            <assigned_regions>Top Region</assigned_regions>
        </material>
    </materials>

    <phases>
        <liquid_phase name="water">
            <viscosity>1.002e-3</viscosity>
            <density>998.2</density>
            <dissolved_components>
                <solutes>
                    <solute coefficient_of_diffusion="1e-9">Tc-99</solute>
                </solutes>
            </dissolved_components>
        </liquid_phase>
    </phases>

    <initial_conditions>
        <initial_condition name="IC">
            <assigned_regions>All</assigned_regions>
            <liquid_phase name="water">
                <liquid_component name="water">
                    <uniform_pressure value="81747.0"/>
                </liquid_component>
                <solute_component function="uniform" name="Tc-99" value="0.0"/>
            </liquid_phase>
        </initial_condition>
    </initial_conditions>
 
    <boundary_conditions>
        <boundary_condition name="Top">
            <assigned_regions>Top Surface</assigned_regions>
            <liquid_phase name="water">
                <liquid_component name="water">
                    <inward_mass_flux function="constant" start="0 y" value="5.776620E-5"/>
                </liquid_component>
            </liquid_phase>
        </boundary_condition>
        <boundary_condition name="Bottom">
            <assigned_regions>Bottom Surface</assigned_regions>
            <liquid_phase name="water">
                <liquid_component name="water">
                    <uniform_pressure function="constant" start="0 y" value="99630.6336"/>
                </liquid_component>
            </liquid_phase>
        </boundary_condition>
    </boundary_conditions>

    <output>
        <vis>
            <base_filename>case_2b_plot</base_filename>
            <num_digits>5</num_digits>
            <cycle_macro>Every_100</cycle_macro>
        </vis>
        <checkpoint>
            <base_filename>case_2b_checkpoint</base_filename>
            <num_digits>5</num_digits>
            <cycle_macro>Every_1000</cycle_macro>
        </checkpoint>
    </output>
</amanzi_input>
